###################
# Generated by Chef
###################
#
# This file configures the New Relic Agent.  New Relic monitors
# <%= @agent_type %> applications with deep visibility and low overhead.  For more
# information, visit www.newrelic.com.
#
# This configuration file is custom generated for NewRelic Administration
#
# This section is for settings common to all environments.
# Do not add anything above this next line.
common: &default_settings
  #
  # ============================== LICENSE KEY ===============================

  # You must specify the license key associated with your New Relic
  # account.  This key binds your Agent's data to your account in the
  # New Relic service.
  license_key: '<%= @license %>'

  # Agent Enabled
  # Use this setting to force the agent to run or not run.
  # Default is true.
  # agent_enabled: true
  <% if @enabled.nil? -%>
  agent_enabled: true
  <% else -%>
  agent_enabled: <%= @enabled %>
  <% end -%>

  # Set to true to enable support for auto app naming.
  # The name of each web app is detected automatically
  # and the agent reports data separately for each one.
  # This provides a finer-grained performance breakdown for
  # web apps in New Relic.
  # Default is false.
  enable_auto_app_naming: false

  # Set to true to enable component-based transaction naming.
  # Set to false to use the URI of a web request as the name of the transaction.
  # Default is true.
  enable_auto_transaction_naming: true

  # Set the name of your application as you'd like it show up in New Relic.
  # if enable_auto_app_naming is false, the agent reports all data to this application.
  # Otherwise, the agent reports only background tasks (transactions for non-web applications) to this application.
  # To report data to more than one application, separate the application names with ";".
  # For example, to report data to"My Application" and "My Application 2" use this:
  # app_name: My Application;My Application 2
  # This setting is required.
  <% if @app_name.nil? %>
  app_name: <%= @agent_type %> Application
  <% else %>
  app_name: <%= @app_name %>
  <% end %>

  # In order for high security to be enabled, this property must be set to true and the high security property in the New Relic user
  # interface must be enabled. Enabling high security means SSL is turned on, request and message queue parameters are not collected, and
  # SQL cannot be sent to New Relic in its raw form.
  <% unless @high_security.nil? %>
  high_security: <%= @high_security %>
  <% end %>

  # The agent uses its own log file to keep its logging
  # separate from that of your application.  Specify the log level here.
  # This setting is dynamic, so changes do not require restarting your application.
  # The levels in increasing order of verboseness are: off, severe, warning, info, fine, finer, finest
  # Default is info.
  <% if @loglevel.nil? %>
  log_level: info
  <% else %>
  log_level: <%= @loglevel %>
  <% end %>

  # Log all data to and from New Relic in plain text.
  # This setting is dynamic, so changes do not require restarting your application.
  # Default is false.
  <% if @audit_mode.nil? %>
  audit_mode: true
  <% else %>
  audit_mode: <%= @audit_mode %>
  <% end %>

  # The number of log files to use.
  # Default is 1.
  <% if @log_file_count.nil? %>
  log_file_count: 1
  <% else %>
  log_file_count: <%= @log_file_count %>
  <% end %>

  # The maximum number of bytes to write to any one log file.
  # The log_file_count must be set greater than 1.
  # Default is 0 (no limit).
  #log_limit_in_kbytes: 0
  <% if @log_limit_in_kbytes.nil? %>
  log_limit_in_kbytes: 0
  <% else %>
  log_limit_in_kbytes: <%= @log_limit_in_kbytes %>
  <% end %>

  # Override other log rolling configuration and roll the logs daily.
  # Default is false.
  #log_daily: false
  <% if @log_daily.nil? %>
  log_daily: false
  <% else %>
  log_daily: <%= @log_daily %>
  <% end %>

  # The name of the log file.
  # Default is newrelic_agent.log.
  <% if @logfile.nil? %>
  log_file: newrelic_agent.log
  <% else %>
  log_file: <%= @logfile %>
  <% end %>

  # The log file directory.
  # Default is the logs directory in the newrelic.jar parent directory.
  <% if @logfile_path.nil? %>
  #log_file_path:
  <% else %>
  log_file_path: <%= @logfile_path %>
  <% end %>

  # The agent communicates with New Relic via https by
  # default.  If you want to communicate with newrelic via http,
  # then turn off SSL by setting this value to false.
  # This work is done asynchronously to the threads that process your
  # application code, so response times will not be directly affected
  # by this change.
  # Default is true.
  <% if @daemon_ssl.nil? %>
  ssl: true
  <% else %>
  ssl: <%= @daemon_ssl %>
  <% end %>

  # Proxy settings for connecting to the New Relic server.
  #
  # If a proxy is used, the host setting is required.  Other settings
  # are optional.  Default port is 8080.  The username and password
  # settings will be used to authenticate to Basic Auth challenges
  # from a proxy server.
  #
  # proxy_host: hostname
  # proxy_port: 8080
  # proxy_user: username
  # proxy_password: password
  <% unless @daemon_proxy_host.nil? %>
  proxy_host: <%= @daemon_proxy_host %>
  <% end %>
  <% unless @daemon_proxy_port.nil? %>
  proxy_port: <%= @daemon_proxy_port %>
  <% end %>
  <% unless @daemon_proxy_user.nil? %>
  proxy_user: <%= @daemon_proxy_user %>
  <% end %>
  <% unless @daemon_proxy_password.nil? %>
  proxy_password: <%= @daemon_proxy_password %>
  <% end %>

  # Tells transaction tracer and error collector (when enabled)
  # whether or not to capture HTTP params.  When true, frameworks can
  # exclude HTTP parameters from being captured.
  # Default is false.
  <% if @capture_params.nil? %>
  capture_params: false
  <% else %>
  capture_params: <%= @capture_params %>
  <% end %>

  # Tells transaction tracer and error collector to not to collect
  # specific http request parameters.
  <% if @ignored_params.nil? %>
  # ignored_params: credit_card, ssn, password
  <% else %>
  ignored_params: <%= @ignored_params %>
  <% end %>

  # Transaction tracer captures deep information about slow
  # transactions and sends this to the New Relic service once a
  # minute. Included in the transaction is the exact call sequence of
  # the transactions including any SQL statements issued.
  transaction_tracer:

    # Transaction tracer is enabled by default. Set this to false to
    # turn it off. This feature is only available at the higher product levels.
    # Default is true.
    <% if @transaction_tracer_enable.nil? %>
    enabled: true
    <% else %>
    enabled: <%= @transaction_tracer_enable %>
    <% end %>

    # Threshold in seconds for when to collect a transaction
    # trace. When the response time of a controller action exceeds
    # this threshold, a transaction trace will be recorded and sent to
    # New Relic. Valid values are any float value, or (default) "apdex_f",
    # which will use the threshold for the "Frustrated" Apdex level
    # (greater than four times the apdex_t value).
    # Default is apdex_f.
    <% if @transaction_tracer_threshold.nil? %>
    transaction_threshold: apdex_f
    <% else %>
    transaction_threshold: <%= @transaction_tracer_threshold %>
    <% end %>

    # When transaction tracer is on, SQL statements can optionally be
    # recorded. The recorder has three modes, "off" which sends no
    # SQL, "raw" which sends the SQL statement in its original form,
    # and "obfuscated", which strips out numeric and string literals.
    # Default is obfuscated.
    <% if @transaction_tracer_record_sql.nil? %>
    record_sql: obfuscated
    <% else %>
    record_sql: <%= @transaction_tracer_record_sql %>
    <% end %>

    # Obfuscate only occurrences of specific SQL fields names.
    # This setting only applies if "record_sql" is set to "raw".
    #obfuscated_sql_fields: credit_card, ssn, password

    # Set this to true to log SQL statements instead of recording them.
    # SQL is logged using the record_sql mode.
    # Default is false.
    log_sql: false

    # Threshold in seconds for when to collect stack trace for a SQL
    # call. In other words, when SQL statements exceed this threshold,
    # then capture and send to New Relic the current stack trace. This is
    # helpful for pinpointing where long SQL calls originate from.
    # Default is 0.5 seconds.
    <% if @transaction_tracer_stack_trace_threshold.nil? %>
    stack_trace_threshold: 0.5
    <% else %>
    stack_trace_threshold: <%= @transaction_tracer_stack_trace_threshold %>
    <% end %>

    # Determines whether the agent will capture query plans for slow
    # SQL queries. Only supported for MySQL and PostgreSQL.
    # Default is true.
    <% if @transaction_tracer_slow_sql.nil? %>
    explain_enabled: true
    <% else %>
    explain_enabled: <%= @transaction_tracer_slow_sql %>
    <% end %>

    # Threshold for query execution time below which query plans will not
    # not be captured.  Relevant only when `explain_enabled` is true.
    # Default is 0.5 seconds.
    <% if @transaction_tracer_explain_threshold.nil? %>
    explain_threshold: 0.5
    <% else %>
    explain_threshold: <%= @transaction_tracer_explain_threshold %>
    <% end %>

    # Use this setting to control the variety of transaction traces.
    # The higher the setting, the greater the variety.
    # Set this to 0 to always report the slowest transaction trace.
    # Default is 20.
    top_n: 20


  # Error collector captures information about uncaught exceptions and
  # sends them to New Relic for viewing
  error_collector:

    # Error collector is enabled by default. Set this to false to turn
    # it off. This feature is only available at the higher product levels.
    # Default is true.
    <% if @error_collector_enable.nil? %>
    enabled: true
    <% else %>
    enabled: <%= @error_collector_enable %>
    <% end %>

    # To stop specific exceptions from reporting to New Relic, set this property
    # to a comma separated list of full class names.
    #
    # ignore_errors:
    <% unless @error_collector_ignore_errors.nil? %>
    ignore_errors: <%= @error_collector_ignore_errors %>
    <% end %>

    # To stop specific http status codes from being reporting to New Relic as errors,
    # set this property to a comma separated list of status codes to ignore.
    # When this property is commented out it defaults to ignoring 404s.
    #
    # ignore_status_codes: 404
    <% unless @error_collector_ignore_status_codes.nil? %>
    ignore_status_codes: <%= @error_collector_ignore_status_codes %>
    <% end %>

  # Cross Application Tracing adds request and response headers to
  # external calls using the Apache HttpClient libraries to provided better
  # performance data when calling applications monitored by other New Relic Agents.
  #
  cross_application_tracer:
    # Set to true to enable cross application tracing.
    # Default is true.
    <%if @cross_application_tracer_enable.nil? %>
    enabled: true
    <% else %>
    enabled: <%= @cross_application_tracer_enable %>
    <% end %>

  # Thread profiler measures wall clock time, CPU time, and method call counts
  # in your application's threads as they run.
  thread_profiler:

    # Set to false to disable the thread profiler.
    # Default is true.
    <% if @thread_profiler_enable.nil? %>
    enabled: true
    <% else %>
    enabled: <%= @thread_profiler_enable %>
    <% end %>

  #============================== Browser Monitoring ===============================
  # New Relic Real User Monitoring gives you insight into the performance real users are
  # experiencing with your website. This is accomplished by measuring the time it takes for
  # your users' browsers to download and render your web pages by injecting a small amount
  # of JavaScript code into the header and footer of each page.
  browser_monitoring:
    # By default the agent automatically inserts API calls in compiled JSPs to
    # inject the monitoring JavaScript into web pages.
    # Set this attribute to false to turn off this behavior.
    <% if @browser_monitoring_auto_instrument.nil? %>
    auto_instrument: true
    <% else %>
    auto_instrument: <%= @browser_monitoring_auto_instrument %>
    <% end %>
    # Set this attribute to false to prevent injection of the monitoring JavaScript.
    # Default is true.
    enabled: true

# Application Environments
# ------------------------------------------
# Environment specific settings are in this section.
# You can use the environment to override the default settings.
# For example, to change the app_name setting.
# Use -Dnewrelic.environment=<environment> on the Java command line
# to set the environment.
# The default environment is production.

# NOTE if your application has other named environments, you should
# provide configuration settings for these environments here.

development:
  <<: *default_settings
  app_name: <%= @app_name %> (Development)

test:
  <<: *default_settings
  app_name: <%= @app_name %> (Test)

production:
  <<: *default_settings

staging:
  <<: *default_settings
  app_name: <%= @app_name %> (Staging)
