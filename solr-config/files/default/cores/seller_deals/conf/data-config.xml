<dataConfig>
  <dataSource type="JdbcDataSource" driver="com.mysql.jdbc.Driver"
    url="jdbc:mysql://192.168.100.231:3306/estantevirtual"                                                                                 
    password="RCifH0slt7" 
    autoReconnect="true"                                                                           
    user="evreader"
    name="seller_deals_ds"
  />

  <document>
    <entity name="order" pk="order_id" dataSource="seller_deals_ds"
        query=" 
          select 
            vd.log as 'sold_at', 
            v.status, 
            v.order_id, 
            vd.dest_nome as 'buyer_name', 
            vd.dest_cidade as 'delivery_city',
            vd.dest_estado as 'delivery_state',
            vd.dest_cep as 'delivery_zip_code',
            v.total,
            v.comprador as 'buyer_id',
            v.vendedor as 'seller_id',
            (
              select group_concat(concat(vi.autor, '-----author-----'), vi.titulo SEPARATOR '----line----')
              from venda_items vi where vi.order_id = v.order_id
            ) as items
          from vendas v 
          left join vendas_detalhes vd on v.order_id = vd.order_id
          where vd.log > DATE_SUB(NOW(), INTERVAL 6 MONTH);
        "
        deltaImportQuery="
          select                                                                                   
             vd.log as 'sold_at',                                                                   
             v.status,                                                                              
             v.order_id,                                                                            
             vd.dest_nome as 'buyer_name',                                                          
             vd.dest_cidade as 'delivery_city',                                                     
             vd.dest_estado as 'delivery_state',                                                    
             vd.dest_cep as 'delivery_zip_code',                                                    
             v.total,                                                                               
             v.comprador as 'buyer_id',                                                             
             v.vendedor as 'seller_id',                                                             
             (                                                                                      
               select group_concat(concat(vi.autor, '-----author-----'), vi.titulo SEPARATOR '----line----')
               from venda_items vi where vi.order_id = v.order_id                                   
             ) as items                                                                               
           from vendas v                                                                            
           left join vendas_detalhes vd on v.order_id = vd.order_id 
           where v.order_id = '${dih.delta.order_id}'
        "
        deltaQuery="
          SELECT v.order_id
          FROM vendas v
          WHERE v.log &gt; '${dih.last_index_time}'
        "
      >
      <field name="sold_at" column="sold_at"/>
      <field name="status" column="status"/>
      <field name="order_id" column="order_id"/>
      <field name="buyer_name" column="buyer_name"/>
      <field name="delivery_city" column="delivery_city"/>
      <field name="delivery_state" column="delivery_state"/>
      <field name="delivery_zip_code" column="delivery_zip_code"/>
      <field name="total" column="total"/>
      <field name="buyer_id" column="buyer_id"/>
      <field name="seller_id" column="seller_id"/>
      <field name="items" column="items"/>      
    </entity>
  </document>
</dataConfig>
