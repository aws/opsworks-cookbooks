<dataConfig>
  <dataSource type="JdbcDataSource" driver="com.mysql.jdbc.Driver"
    url="jdbc:mysql://192.168.100.231:3306/estantevirtual"                                                                                 
    password="RCifH0slt7" 
    autoReconnect="true"                                                                           
    user="evreader"
    name="seller_deals_ds"
  />

  <document>
    <entity name="order" pk="order_id" dataSource="seller_deals_ds"
        query=" 
            select 
                vd.log as 'sold_at', 
                v.status, 
                v.order_id, 
                vd.dest_nome as 'buyer_name', 
                vd.dest_cidade as 'delivery_city',
                vd.dest_estado as 'delivery_state',
                vd.dest_cep as 'delivery_zip_code',
                v.total,
                v.comprador as 'buyer_id',
                v.vendedor as 'seller_id'
            from vendas v 
            left join vendas_detalhes vd on v.order_id = vd.order_id
            where vd.log > DATE_SUB(NOW(), INTERVAL 6 MONTH)
        "
        deltaImportQuery="
            select                                                          
                vd.log as 'sold_at',                                        
                v.status,                                                   
                cast(v.order_id as char) as order_id, 
                vd.dest_nome as 'buyer_name',                               
                vd.dest_cidade as 'delivery_city',                          
                vd.dest_estado as 'delivery_state',                         
                vd.dest_cep as 'delivery_zip_code',                         
                v.total,                                                    
                v.comprador as 'buyer_id',                                  
                v.vendedor as 'seller_id'                                   
            from vendas v                                                   
            left join vendas_detalhes vd on v.order_id = vd.order_id        
            where v.order_id = '${dataimporter.delta.order_id}'
        "
        deltaQuery="
          SELECT v.order_id
          FROM vendas v
          WHERE v.log &gt; '${dataimporter.last_index_time}'
        "
      >
      
      <entity name="title_and_authors" pk="order_id" dataSource="seller_deals_ds"
        query="
          select 
            vi.titulo as 'title', 
            vi.autor as 'author',
            vi.order_id
            from venda_items vi" 
        cacheImpl="SortedMapBackedCache"
        cacheLookup="order.order_id"
        cacheKey="order_id"

        deltaQuery="                                                                               
           select 
             cast(vi.order_id as char) as order_id,
             vi.autor as 'author',
             vi.titulo as 'title'
           from venda_items vi 
           join vendas v on v.order_id = vi.order_id
           where v.log &gt; '${dataimporter.last_index_time}'  
        "
      >
        <field name="authors" column="author"/>
        <field name="titles" column="title"/>
      </entity>
    </entity>
  </document>
</dataConfig>

    