<dataConfig>
<!--     user="amsterdam"
    password="amsterdam" -->
  <dataSource type="JdbcDataSource" driver="org.postgresql.Driver"
    url="jdbc:postgresql://library-sg.c6orwgo57rj2.us-east-1.rds.amazonaws.com/library_staging"
    user="librarysg"
    password="library-sg"
    autoReconnect="true"
    />
  <document>

    <entity name="sku"
     query="SELECT 
              md5(concat(b.id, p.id, s.id)) as id,
              b.id book_id, b.title, b.synopsis,  md5(synopsis) md5_synopsis, b.volume, 
              p.id as publication_id, p.isbn, p.issn, p.barcode, p.edition, p.weight, p.height, p.width, p.depth, p.year, p.pages, pbrs.name publisher, p.created_at, p.updated_at, p.deleted_at, 
              s.id as sku, s.seller_id as seller_id, s.price, (CASE WHEN s.is_new THEN 1 ELSE 0 END) new, 
              (CASE WHEN s.is_new THEN 1 ELSE 0 END) used, s.quantity, p.isbn, p.issn, p.barcode
            FROM books b
            left join publications p on p.book_id = b.id
            left join skus s on s.publication_id = p.id
            inner join publishers pbrs on pbrs.id = p.publisher_id
            ">


      <entity name="author" query="select concat(first_name, ' ', last_name) author_name from authors a join authors_books ab on a.id = ab.author_id where ab.book_id = ${sku.book_id}">

        <field name="authors" column="author_name"/>
      </entity>

    </entity>


  </document>
</dataConfig>